#!/bin/bash

# ๐งน ะกะบัะธะฟั ะพัะธััะบะธ ะฟัะพะตะบัะฐ CleanWhale
# ะฃะดะฐะปัะตั ะฒัะตะผะตะฝะฝัะต ัะฐะนะปั ะธ ะฟะฐะฟะบะธ, ะบะพัะพััะต ะผะพะถะฝะพ ะฟะตัะตัะพะทะดะฐัั

set -e  # ะััะฐะฝะพะฒะบะฐ ะฟัะธ ะพัะธะฑะบะต

# ะฆะฒะตัะฐ
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo -e "${BLUE}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${BLUE}โ  ๐งน ะัะธััะบะฐ ะฟัะพะตะบัะฐ CleanWhale          โ${NC}"
echo -e "${BLUE}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""

# ะคัะฝะบัะธั ะดะปั ะฑะตะทะพะฟะฐัะฝะพะณะพ ัะดะฐะปะตะฝะธั
safe_remove() {
    local path=$1
    local description=$2
    local size=$3
    
    if [ -e "$path" ]; then
        echo -e "${YELLOW}ะฃะดะฐะปัั:${NC} $description ($size)"
        rm -rf "$path"
        echo -e "${GREEN}โ ะฃะดะฐะปะตะฝะพ${NC}"
    else
        echo -e "${BLUE}โ ะัะพะฟััะตะฝะพ:${NC} $description (ะฝะต ะฝะฐะนะดะตะฝะพ)"
    fi
    echo ""
}

# ะัะพะฒะตััะตะผ ัะฐะทะผะตั ะดะพ ะพัะธััะบะธ
echo -e "${BLUE}ะะฐะทะผะตั ะฟัะพะตะบัะฐ ะะ ะพัะธััะบะธ:${NC}"
du -sh . 2>/dev/null || echo "ะะต ัะดะฐะปะพัั ะพะฟัะตะดะตะปะธัั"
echo ""
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# 1. ะฃะดะฐะปัะตะผ node_modules
safe_remove "node_modules" "node_modules (npm ะทะฐะฒะธัะธะผะพััะธ)" "~723 MB"

# 2. ะฃะดะฐะปัะตะผ .next
safe_remove ".next" ".next (ัะพะฑัะฐะฝะฝะพะต ะฟัะธะปะพะถะตะฝะธะต)" "~287 MB"

# 3. ะฃะดะฐะปัะตะผ ะปะพะบะฐะปัะฝัั ะะ ะดะปั ัะฐะทัะฐะฑะพัะบะธ
safe_remove "dev.db" "dev.db (ะปะพะบะฐะปัะฝะฐั ะะ)" "128 KB"

# 4. ะฃะดะฐะปัะตะผ ัะตััะพะฒัะต ัะบัะธะฟัั
echo -e "${YELLOW}ะฃะดะฐะปัั ัะตััะพะฒัะต ัะฐะนะปั...${NC}"
rm -f test-*.js test-*.mjs quick-test.js 2>/dev/null || true
echo -e "${GREEN}โ ะขะตััะพะฒัะต ัะฐะนะปั ัะดะฐะปะตะฝั${NC}"
echo ""

# 5. ะฃะดะฐะปัะตะผ ะฒัะตะผะตะฝะฝัะต ัะฐะนะปั Next.js
safe_remove ".vercel" ".vercel (ะฒัะตะผะตะฝะฝัะต ัะฐะนะปั Vercel)" "ะฝะตัะบะพะปัะบะพ KB"

# 6. ะฃะดะฐะปัะตะผ ะบััะธ
safe_remove ".turbo" ".turbo (ะบัั ัะฑะพัะบะธ)" "ะตัะปะธ ะตััั"
safe_remove ".cache" ".cache (ะฒัะตะผะตะฝะฝัะน ะบัั)" "ะตัะปะธ ะตััั"

# 7. npm/yarn ะบัั
if [ -d "node_modules/.cache" ]; then
    safe_remove "node_modules/.cache" "npm ะบัั" "ะตัะปะธ ะตััั"
fi

echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo ""

# ะัะพะฒะตััะตะผ ัะฐะทะผะตั ะฟะพัะปะต ะพัะธััะบะธ
echo -e "${BLUE}ะะฐะทะผะตั ะฟัะพะตะบัะฐ ะะะกะะ ะพัะธััะบะธ:${NC}"
du -sh . 2>/dev/null || echo "ะะต ัะดะฐะปะพัั ะพะฟัะตะดะตะปะธัั"
echo ""

echo -e "${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo -e "${GREEN}โ  โ ะัะธััะบะฐ ะทะฐะฒะตััะตะฝะฐ ััะฟะตัะฝะพ!           โ${NC}"
echo -e "${GREEN}โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ${NC}"
echo ""
echo -e "${YELLOW}๐ ะงัะพ ะดะฐะปััะต:${NC}"
echo ""
echo "ะะปั ะฟัะพะดะพะปะถะตะฝะธั ัะฐะทัะฐะฑะพัะบะธ ะฒัะฟะพะปะฝะธัะต:"
echo -e "  ${BLUE}npm install${NC}        # ะฃััะฐะฝะพะฒะธั ะทะฐะฒะธัะธะผะพััะธ (3-5 ะผะธะฝ)"
echo -e "  ${BLUE}npm run dev${NC}        # ะะฐะฟัััะธั ะฟัะพะตะบั"
echo ""
echo "ะะปั ะดะตะฟะปะพั ะฝะฐ ัะตัะฒะตั:"
echo -e "  ${BLUE}./deploy-to-server.sh user@server-ip${NC}"
echo ""
echo -e "${GREEN}ะัะต ะฒะฐะถะฝัะต ัะฐะนะปั ัะพััะฐะฝะตะฝั! โ${NC}"
echo ""




