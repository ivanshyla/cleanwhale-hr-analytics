# ‚öôÔ∏è –ù–ê–°–¢–†–û–ô–ö–ê CONNECTION POOL –î–õ–Ø –°–¢–ê–ë–ò–õ–¨–ù–û–°–¢–ò

## üéØ –ü—Ä–æ–±–ª–µ–º–∞:

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é Prisma —Å–æ–∑–¥–∞–µ—Ç **–û–ß–ï–ù–¨ –ú–ê–õ–ï–ù–¨–ö–ò–ô** connection pool:
- –ü—Ä–∏–º–µ—Ä–Ω–æ 10 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ü—Ä–∏ 12+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—Ç—Å—è
- –ó–∞–ø—Ä–æ—Å—ã –∑–∞–≤–∏—Å–∞—é—Ç, –ø–æ—è–≤–ª—è—é—Ç—Å—è timeout'—ã
- –û—à–∏–±–∫–∞ "Too many connections" –∏–ª–∏ "Connection timeout"

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ DATABASE_URL

### –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Supabase:

```bash
# –í —Ñ–∞–π–ª–µ .env –∏–ª–∏ .env.local

# –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
DATABASE_URL="postgresql://user:pass@host:5432/database"

# –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
DATABASE_URL="postgresql://user:pass@host:5432/database?connection_limit=20&pool_timeout=10"
```

### –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –æ–±—ã—á–Ω—ã–π PostgreSQL:

```bash
# –í —Ñ–∞–π–ª–µ .env –∏–ª–∏ .env.local

# –ë–´–õ–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
DATABASE_URL="postgresql://postgres:password@localhost:5432/hr_analytics"

# –°–¢–ê–õ–û (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
DATABASE_URL="postgresql://postgres:password@localhost:5432/hr_analytics?connection_limit=20&pool_timeout=10&connect_timeout=10"
```

---

## üìä –ü–∞—Ä–∞–º–µ—Ç—Ä—ã Connection Pool:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|----------|----------|----------|
| `connection_limit` | **20** | –ú–∞–∫—Å–∏–º—É–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –≤ pool |
| `pool_timeout` | **10** | Timeout –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (—Å–µ–∫) |
| `connect_timeout` | **10** | Timeout –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î (—Å–µ–∫) |

### –ü–æ—á–µ–º—É 20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π?

–†–∞—Å—á–µ—Ç –¥–ª—è –≤–∞—à–µ–π —Å–∏—Å—Ç–µ–º—ã:
- 14 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–º–µ–Ω–µ–¥–∂–µ—Ä—ã + –∞–¥–º–∏–Ω—ã)
- –í —Å—Ä–µ–¥–Ω–µ–º 2-3 –∑–∞–ø—Ä–æ—Å–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- 14 √ó 3 = 42 —Ç–µ–æ—Ä–µ—Ç–∏—á–µ—Å–∫–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **–ù–æ!** Prisma –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- 20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π = –∑–∞–ø–∞—Å –¥–ª—è –ø–∏–∫–æ–≤–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏

---

## üîß –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å:

### –í–∞—Ä–∏–∞–Ω—Ç 1: –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

```bash
# –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª .env.local
nano .env.local

# –ù–∞–π–¥–∏—Ç–µ DATABASE_URL –∏ –¥–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
DATABASE_URL="postgresql://...?connection_limit=20&pool_timeout=10"

# –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ (Ctrl+O, Enter, Ctrl+X)

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä
npm run dev
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Production (Vercel/–¥—Ä—É–≥–æ–π —Ö–æ—Å—Ç–∏–Ω–≥)

1. –ó–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
2. –ù–∞–π–¥–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Environment Variables)
3. –û–±–Ω–æ–≤–∏—Ç–µ `DATABASE_URL`
4. –î–æ–±–∞–≤—å—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `?connection_limit=20&pool_timeout=10`
5. Redeploy –ø—Ä–æ–µ–∫—Ç–∞

### –í–∞—Ä–∏–∞–Ω—Ç 3: Docker

```yaml
# docker-compose.yml
environment:
  DATABASE_URL: "postgresql://postgres:password@postgres:5432/hr_analytics?connection_limit=20&pool_timeout=10"
```

---

## üß™ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### 1. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ Prisma

```bash
# –í .env –¥–æ–±–∞–≤—å—Ç–µ:
DEBUG="prisma:query,prisma:engine"

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ
npm run dev

# –í—ã –¥–æ–ª–∂–Ω—ã –≤–∏–¥–µ—Ç—å –≤ –ª–æ–≥–∞—Ö:
# prisma:engine Connection pool created with 20 slots
```

### 2. –¢–µ—Å—Ç –Ω–∞–≥—Ä—É–∑–∫–∏

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ
for i in {1..15}; do
  curl http://localhost:3000/api/dashboard-stats &
done
wait

# –í—Å–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è —É—Å–ø–µ—à–Ω–æ –±–µ–∑ timeout
```

### 3. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

```sql
-- –í PostgreSQL –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
SELECT count(*) as connections, usename, application_name
FROM pg_stat_activity
WHERE datname = 'hr_analytics'
GROUP BY usename, application_name;

-- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ 20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –æ—Ç Prisma
```

---

## ‚ö†Ô∏è –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å:

### PostgreSQL –ª–∏–º–∏—Ç—ã

PostgreSQL –∏–º–µ–µ—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π:
```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–µ–∫—É—â–∏–π –ª–∏–º–∏—Ç:
SHOW max_connections;

-- –û–±—ã—á–Ω–æ: 100 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
```

–ï—Å–ª–∏ —É –≤–∞—Å **–Ω–µ—Å–∫–æ–ª—å–∫–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π** –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω—É –ë–î:
- 1 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ = 20 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- 5 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π = 100 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ú–æ–∂–Ω–æ —É–ø–µ—Ä–µ—Ç—å—Å—è –≤ –ª–∏–º–∏—Ç!

**–†–µ—à–µ–Ω–∏–µ:**
- –£–º–µ–Ω—å—à–∏—Ç–µ `connection_limit` –¥–æ 10-15
- –ò–ª–∏ —É–≤–µ–ª–∏—á—å—Ç–µ `max_connections` –≤ PostgreSQL

### Supabase –ª–∏–º–∏—Ç—ã

Supabase –∏–º–µ–µ—Ç **—Å–≤–æ–∏ –ª–∏–º–∏—Ç—ã** –ø–æ —Ç–∞—Ä–∏—Ñ—É:
- Free: 60 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- Pro: 200 —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- Enterprise: Unlimited

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Supabase Free, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:
```bash
DATABASE_URL="...?connection_limit=15&pool_timeout=10"
# 15 –≤–º–µ—Å—Ç–æ 20 –¥–ª—è –∑–∞–ø–∞—Å–∞
```

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

### –ß—Ç–æ –º–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å:

1. **Connection pool exhaustion**
   ```
   ‚ùå Error: Timed out fetching a new connection from the pool
   ```
   **–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–∏—Ç—å `connection_limit`

2. **Too many connections**
   ```
   ‚ùå Error: sorry, too many clients already
   ```
   **–†–µ—à–µ–Ω–∏–µ:** –£–º–µ–Ω—å—à–∏—Ç—å `connection_limit` –∏–ª–∏ —É–≤–µ–ª–∏—á–∏—Ç—å `max_connections` –≤ PostgreSQL

3. **Connection timeouts**
   ```
   ‚ùå Error: Connection timeout
   ```
   **–†–µ—à–µ–Ω–∏–µ:** –£–≤–µ–ª–∏—á–∏—Ç—å `connect_timeout` –∏ `pool_timeout`

---

## ‚úÖ –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:

–û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
- ‚úÖ –õ–æ–≥–∏–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ —Å –ø–µ—Ä–≤–æ–≥–æ —Ä–∞–∑–∞
- ‚úÖ –ù–∏–∫–æ–≥–æ –Ω–µ –≤—ã–∫–∏–¥—ã–≤–∞–µ—Ç –∏–∑ —Å–∏—Å—Ç–µ–º—ã
- ‚úÖ –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –±–µ–∑ –∑–∞–¥–µ—Ä–∂–µ–∫
- ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ "Connection timeout"
- ‚úÖ –ü—Ä–∏ 15 –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üîç –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):

### –î–ª—è Supabase:

```bash
# –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ pooling mode –¥–ª—è –µ—â–µ –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
DATABASE_URL="postgresql://...?pgbouncer=true&connection_limit=20"
```

### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ PostgreSQL:

```bash
# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ PostgreSQL –¥–ª—è –ª—É—á—à–µ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
# –í postgresql.conf:
shared_buffers = 256MB
effective_cache_size = 1GB
max_connections = 200
```

---

**–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ!** üöÄ

_–î–æ–∫—É–º–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω: 10 –æ–∫—Ç—è–±—Ä—è 2025_

