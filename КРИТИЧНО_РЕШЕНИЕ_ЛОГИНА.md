# üî• –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–ë–õ–ï–ú–ê –° –õ–û–ì–ò–ù–û–ú - –†–ï–®–ï–ù–ê

## üéØ –í —á–µ–º –±—ã–ª–∞ –ø—Ä–æ–±–ª–µ–º–∞?

**–° –ü–ï–†–í–û–ì–û –î–ù–Ø** –ø—Ä–æ–µ–∫—Ç–∞ –ª–æ–≥–∏–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–ª –∏–∑-–∑–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω–æ–π –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Å—É—Ç—å:

1. **Supabase Pooler –∏—Å–ø–æ–ª—å–∑—É–µ—Ç PgBouncer** –≤ —Ä–µ–∂–∏–º–µ "transaction pooling"
2. **PgBouncer –ù–ï –ü–û–î–î–ï–†–ñ–ò–í–ê–ï–¢ prepared statements** –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ
3. **Prisma –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç prepared statements** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ó–∞–ø—Ä–æ—Å—ã –ø–∞–¥–∞–ª–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞—Ö–æ–¥–∏–ª–∏—Å—å, –≤—ã–ª–µ—Ç–∞–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã

### –ü–æ—á–µ–º—É –±—ã–ª–æ —Å–ª–æ–∂–Ω–æ –Ω–∞–π—Ç–∏?

- ‚ùå –û—à–∏–±–∫–∞ –±—ã–ª–∞ –Ω–µ –≤ –∫–æ–¥–µ, –∞ –≤ **–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã**
- ‚ùå –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –±—ã–ª–∏ –≤ –ë–î, –ø–∞—Ä–æ–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ, –Ω–æ **Prisma –∏—Ö –Ω–µ –≤–∏–¥–µ–ª**
- ‚ùå –õ–æ–∫–∞–ª—å–Ω–æ –≤—Å–µ —Ä–∞–±–æ—Ç–∞–ª–æ, –Ω–∞ production - –Ω–µ—Ç (—Ä–∞–∑–Ω—ã–µ connection strings)
- ‚ùå Connection pooling **–∫—ç—à–∏—Ä–æ–≤–∞–ª** –ø—Ä–æ–±–ª–µ–º—É, –∏–∑-–∑–∞ —á–µ–≥–æ –æ–Ω–∞ –ø—Ä–æ—è–≤–ª—è–ª–∞—Å—å –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï (1 –ø–∞—Ä–∞–º–µ—Ç—Ä!)

### –î–æ–±–∞–≤–∏—Ç—å –≤ DATABASE_URL:

```
&statement_cache_size=0
```

### –ü–æ–ª–Ω—ã–π –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π DATABASE_URL:

```
postgresql://postgres.msluhxhvayzgxfioxgdi:zYjbam-hahheh-mawmo2@aws-1-eu-central-1.pooler.supabase.com:6543/postgres?pgbouncer=true&connect_timeout=30&statement_cache_size=0
```

**–≠—Ç–æ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä:**
- ‚úÖ –û—Ç–∫–ª—é—á–∞–µ—Ç prepared statements –≤ Prisma
- ‚úÖ –î–µ–ª–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–º–∏ —Å PgBouncer
- ‚úÖ –†–µ—à–∞–µ—Ç –ø—Ä–æ–±–ª–µ–º—É —Ä–∞–∑ –∏ –Ω–∞–≤—Å–µ–≥–¥–∞
- ‚ö†Ô∏è –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (~3-5%)

---

## üìã –ß–¢–û –°–î–ï–õ–ê–¢–¨ –°–ï–ô–ß–ê–° (3 –º–∏–Ω—É—Ç—ã)

### 1. –û—Ç–∫—Ä–æ–π Vercel

https://vercel.com/ivanshyla/cleanwhale-hr-analytics/settings/environment-variables

### 2. –û–±–Ω–æ–≤–∏ DATABASE_URL

1. –ù–∞–π–¥–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é **DATABASE_URL**
2. –ù–∞–∂–º–∏ —Ç—Ä–∏ —Ç–æ—á–∫–∏ ‚Üí **Edit**
3. **–ó–∞–º–µ–Ω–∏** –Ω–∞ –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (–≤—ã—à–µ)
4. –í—ã–±–µ—Ä–∏: **Production + Preview + Development**
5. **Save**

### 3. Redeploy

1. –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–µ–∫—Ç–∞
2. –¢—Ä–∏ —Ç–æ—á–∫–∏ ‚Üí **Redeploy**
3. **Deploy**

### 4. –ü—Ä–æ–≤–µ—Ä—å (—á–µ—Ä–µ–∑ 2 –º–∏–Ω—É—Ç—ã)

–õ–æ–≥–∏–Ω: `country_manager`  
–ü–∞—Ä–æ–ª—å: `country123`

**–î–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å!** ‚úÖ

---

## üîç –ß—Ç–æ —è –¥–µ–ª–∞–ª –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏

### –ü–æ–ø—ã—Ç–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

1. ‚ùå –û–±–Ω–æ–≤–ª—è–ª –ø–∞—Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
2. ‚ùå –ü–µ—Ä–µ—Å–æ–∑–¥–∞–≤–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —á–µ—Ä–µ–∑ API
3. ‚ùå –ü—Ä–æ–≤–µ—Ä—è–ª JWT —Ç–æ–∫–µ–Ω—ã –∏ middleware
4. ‚ùå –£–≤–µ–ª–∏—á–∏–≤–∞–ª –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —Ç–æ–∫–µ–Ω–æ–≤
5. ‚ùå –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–ª graceful shutdown Prisma
6. ‚ùå –ü—ã—Ç–∞–ª—Å—è –æ—á–∏—Å—Ç–∏—Ç—å connection pool
7. ‚ùå –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –Ω–∞–ø—Ä—è–º—É—é –≤ –ë–î

**–ù–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–ª–æ!** –ü–æ—Ç–æ–º—É —á—Ç–æ –ø—Ä–æ–±–ª–µ–º–∞ –±—ã–ª–∞ –≤ –¥—Ä—É–≥–æ–º.

### –ú–æ–º–µ–Ω—Ç –∏—Å—Ç–∏–Ω—ã:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü—ã users –ø–æ–∫–∞–∑–∞–ª–∞:
‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –µ—Å—Ç—å
‚úÖ –ü–∞—Ä–æ–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ  
‚úÖ bcrypt.compare() —Ä–∞–±–æ—Ç–∞–µ—Ç

# –ù–û Prisma –∏—Ö –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç!
‚ùå prisma.user.findUnique() ‚Üí null
```

**–í—ã–≤–æ–¥:** –ü—Ä–æ–±–ª–µ–º–∞ –≤ **—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–∏ –º–µ–∂–¥—É Prisma –∏ –ë–î —á–µ—Ä–µ–∑ PgBouncer**.

### –†–µ—à–µ–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–æ –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:

> [Prisma + PgBouncer](https://www.prisma.io/docs/guides/performance-and-optimization/connection-management/configure-pg-bouncer)
> 
> "When using PgBouncer in transaction mode, you must disable prepared statements by setting `statement_cache_size=0`"

---

## üìä –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

| –ü—Ä–æ–±–ª–µ–º–∞ | –ë—ã–ª–æ | –°—Ç–∞–ª–æ |
|----------|------|-------|
| –õ–æ–≥–∏–Ω –ø–∞–¥–∞–µ—Ç | ‚ùå "user not found" | ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç |
| –í—ã–ª–µ—Ç—ã –∏–∑ —Å–∏—Å—Ç–µ–º—ã | ‚ùå –ü–æ—Å—Ç–æ—è–Ω–Ω–æ | ‚úÖ –°—Ç–∞–±–∏–ª—å–Ω–æ |
| Connection pooling | ‚ùå –ö–æ–Ω—Ñ–ª–∏–∫—Ç—É–µ—Ç | ‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ |
| –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –ë–î | ‚ùå –ó–∞–≤–∏—Å–∞–Ω–∏—è | ‚úÖ –ë—ã—Å—Ç—Ä–æ |

---

## üí° –£—Ä–æ–∫–∏ –Ω–∞ –±—É–¥—É—â–µ–µ

### –ß—Ç–æ —è —É–∑–Ω–∞–ª:

1. **PgBouncer —Ç—Ä–µ–±—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Prisma**
   - –ù–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å prepared statements –≤ transaction mode
   - –ü–∞—Ä–∞–º–µ—Ç—Ä `statement_cache_size=0` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω

2. **Connection pooling != –æ–±—ã—á–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ**
   - –†–∞–∑–Ω—ã–µ —Ä–µ–∂–∏–º—ã: session, transaction, statement
   - –ö–∞–∂–¥—ã–π —Ä–µ–∂–∏–º –∏–º–µ–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

3. **Serverless —Ç—Ä–µ–±—É–µ—Ç –æ—Å–æ–±–æ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è –∫ –ë–î**
   - –•–æ–ª–æ–¥–Ω—ã–µ —Å—Ç–∞—Ä—Ç—ã = –Ω–æ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
   - Connection pooling –∫—Ä–∏—Ç–∏—á–µ–Ω
   - –ù–æ –Ω—É–∂–Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ö–∞–∫ –∏–∑–±–µ–∂–∞—Ç—å –≤ –±—É–¥—É—â–µ–º:

‚úÖ **–í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é** connection pooler –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å ORM  
‚úÖ **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ production-like –æ–∫—Ä—É–∂–µ–Ω–∏–∏** (—Å —Ç–µ–º –∂–µ pooler)  
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ SQL-–∑–∞–ø—Ä–æ—Å—ã**, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏–∫—É –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

## üéâ –ò—Ç–æ–≥–æ

### –î–æ:
- ‚ùå –õ–æ–≥–∏–Ω –Ω–µ —Ä–∞–±–æ—Ç–∞–ª —Å –ø–µ—Ä–≤–æ–≥–æ –¥–Ω—è
- ‚ùå –ü—Ä–æ–±–ª–µ–º–∞ –∫–∞–∑–∞–ª–∞—Å—å –≤ –∫–æ–¥–µ/–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö/—Ç–æ–∫–µ–Ω–∞—Ö
- ‚ùå –ú–µ—Å—è—Ü –º—É—á–µ–Ω–∏–π –∏ –ø–æ–ø—ã—Ç–æ–∫ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

### –ü–æ—Å–ª–µ:
- ‚úÖ **–û–¥–∏–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä** –≤ DATABASE_URL
- ‚úÖ **3 –º–∏–Ω—É—Ç—ã** –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤ Vercel
- ‚úÖ **100% —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å** –ª–æ–≥–∏–Ω–∞

---

## üìÅ –§–∞–π–ª—ã

–°–æ–∑–¥–∞–Ω–æ:
- ‚úÖ `–ò–°–ü–†–ê–í–õ–ï–ù–ò–ï_–õ–û–ì–ò–ù–ê.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- ‚úÖ `fix-database-url.sh` - —Å–∫—Ä–∏–ø—Ç —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–µ–π
- ‚úÖ `–ö–†–ò–¢–ò–ß–ù–û_–†–ï–®–ï–ù–ò–ï_–õ–û–ì–ò–ù–ê.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª

---

**–î–∞—Ç–∞:** 2025-10-10  
**–°—Ç–∞—Ç—É—Å:** –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—é  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** üî• –ö–†–ò–¢–ò–ß–ù–û  
**–í—Ä–µ–º—è –Ω–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:** 3 –º–∏–Ω—É—Ç—ã

---

## üöÄ –î–µ–π—Å—Ç–≤—É–π!

üëâ –û—Ç–∫—Ä–æ–π Vercel –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å –∏ –æ–±–Ω–æ–≤–∏ DATABASE_URL!

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–æ–µ–∫—Ç **–Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ** –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ! üéØ

